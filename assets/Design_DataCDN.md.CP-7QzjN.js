import{_ as s,c as a,o as i,a4 as n}from"./chunks/framework.Br2U662V.js";const c=JSON.parse('{"title":"资源部署与缓存","description":"","frontmatter":{},"headers":[],"relativePath":"Design/DataCDN.md","filePath":"Design/DataCDN.md"}'),e={name:"Design/DataCDN.md"},t=n(`<h1 id="资源部署与缓存" tabindex="-1">资源部署与缓存 <a class="header-anchor" href="#资源部署与缓存" aria-label="Permalink to &quot;资源部署与缓存&quot;">​</a></h1><p>在转换完成后，会在导出路径下生成如下目录</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> minigame</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">└──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> webgl</span></span></code></pre></div><ul><li>webgl目录为游戏对应的webgl版本。</li><li>minigame目录为转化后的小游戏代码。</li></ul><p>其中webgl目录结构如下：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 01367b188873c923.webgl.data.unityweb.bin.txt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Assets</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">│  </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 15032.wav</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">│  </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Audio</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">│  </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> └──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Textures</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Build</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">│  </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> UnityLoader.js</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">│  </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> webgl.data.unityweb</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">│  </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> webgl.json</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">│  </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> webgl.wasm.code.unityweb</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">│  </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> webgl.wasm.framework.unityweb</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">│  </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> └──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> webgl.wasm.symbols.unityweb</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> StreamingAssets</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">│  </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> └──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> AssetBundles</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> index.html</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">└──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> texture-config.js</span></span></code></pre></div><h2 id="资源部署" tabindex="-1">资源部署 <a class="header-anchor" href="#资源部署" aria-label="Permalink to &quot;资源部署&quot;">​</a></h2><p><strong>导出目录中，webgl目录如下三个文件和目录是可能需要远程部署的资源：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 01367b188873c923.webgl.data.unityweb.bin.txt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Assets</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> StreamingAssets</span></span></code></pre></div><h3 id="首资源包" tabindex="-1">首资源包 <a class="header-anchor" href="#首资源包" aria-label="Permalink to &quot;首资源包&quot;">​</a></h3><p>首资源包即<code>01367b188873c923.webgl.data.unityweb.bin.txt</code>，包含<strong>Unity builtin + 勾选的导出场景 + Resources</strong>资源。 注意：加载方式取决于导出选项中的<code>首包资源加载方式</code>。同时由于小游戏总包体不能超过<strong>20MB</strong>，实际首包资源加载方式会根据包体决定，更多信息可查看<a href="./UsingLoader.html#_3-3-首包资源加载方式">UnityLoader-首包资源加载方式</a></p><ul><li>小游戏分包：因需要统计总包体大小，当导出时wasm代码brotli压缩正常的前提下，如果wasm代码+首包资源小于20MB，可使用&quot;小游戏包内&quot;加载，此时<strong>不需要将首包资源部署到服务器</strong>。</li><li>CDN：当不使用小游戏分包时，需要部署到服务器。</li></ul><h3 id="assets" tabindex="-1">Assets <a class="header-anchor" href="#assets" aria-label="Permalink to &quot;Assets&quot;">​</a></h3><p>如果有用到纹理压缩，导出插件自动生成。将此目录部署到服务器即可</p><h3 id="streamingassets" tabindex="-1">StreamingAssets <a class="header-anchor" href="#streamingassets" aria-label="Permalink to &quot;StreamingAssets&quot;">​</a></h3><p>AssetBundle和Addressables资源目录。 如果是用的AA，构建时默认打包到StreamingAssets目录下。但如果是用的AB，或者自定义了bundle的生成目录，需要将bundle移动到StreamingAssets目录</p><h3 id="资源服务器注意事项" tabindex="-1">资源服务器注意事项 <a class="header-anchor" href="#资源服务器注意事项" aria-label="Permalink to &quot;资源服务器注意事项&quot;">​</a></h3><ol><li>针对txt文件进行开启Brotli或gzip压缩，<strong>首资源包有非常高的压缩率</strong></li><li>小游戏资源下载并发数为10，超过时底层自动排队</li><li>单个请求文件最大<strong>不超过100MB，超时默认为60s</strong>(理论最大值，实际游戏永远不要让单个文件这么大，考虑到玩家平均下载带宽，建议单文件2~5MB以内)</li><li>网络安全域名、跨域、SSL等问题请参考文档<a href="./UsingNetworking.html">网络通信适配</a></li></ol><h2 id="资源更新说明" tabindex="-1">资源更新说明 <a class="header-anchor" href="#资源更新说明" aria-label="Permalink to &quot;资源更新说明&quot;">​</a></h2><blockquote><p>请注意!!! bundle的配置文件，比如aa的<code>setting.json</code>和<code>catalog.json</code>，以及<code>AssetBundles</code>打包生成的配置文件通常没有带上hash，为了避免新版本发布时由于cdn缓存导致加载到旧版本资源，需要避免这些文件使用缓存。通常有以下两种方式避免。</p></blockquote><ol><li>每次发新版本更换cdn路径，比如<code>version1/xxxx</code>,<code>version2/xxxx</code></li><li>不希望被缓存的文件，源站或者cdn加上不允许缓存的HTTP头，如<code>no-cache</code>，请自行查询对应cdn服务商文档进行设置</li></ol><p>同时，由于通过HTTP请求的资源会自动缓存，不希望被缓存的文件请添加到缓存忽略目录，具体可阅读后续<strong>资源缓存规则</strong>文档</p><blockquote><p>除非了解小程序更新机制，请勿删除旧版本资源，否则可能导致旧版本游戏的用户运行报错，具体请移步<a href="./Update.html">版本更新</a></p></blockquote><h2 id="资源缓存" tabindex="-1">资源缓存 <a class="header-anchor" href="#资源缓存" aria-label="Permalink to &quot;资源缓存&quot;">​</a></h2><p>这里主要讲UnityLoader的资源缓存策略。</p><h3 id="资源缓存规则" tabindex="-1">资源缓存规则 <a class="header-anchor" href="#资源缓存规则" aria-label="Permalink to &quot;资源缓存规则&quot;">​</a></h3><p>请阅读<a href="./FileCache.html">资源缓存</a></p>`,27),l=[t];function h(p,k,r,d,o,F){return i(),a("div",null,l)}const b=s(e,[["render",h]]);export{c as __pageData,b as default};
