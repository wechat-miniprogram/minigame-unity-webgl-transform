import{_ as i,c as s,o as a,a4 as e}from"./chunks/framework.Br2U662V.js";const t="/minigame-unity-webgl-transform/assets/androidprofile1.CWmGtjYo.png",n="/minigame-unity-webgl-transform/assets/androidprofile2.BV1rYep4.png",l="/minigame-unity-webgl-transform/assets/androidprofile5.v23kq4o6.png",r="/minigame-unity-webgl-transform/assets/androidprofile3.C3xDSI1N.png",p="/minigame-unity-webgl-transform/assets/androidprofile4.D2zXydy3.png",u=JSON.parse('{"title":"使用Android CPU Profiler性能调优","description":"","frontmatter":{},"headers":[],"relativePath":"Design/AndroidProfile.md","filePath":"Design/AndroidProfile.md"}'),o={name:"Design/AndroidProfile.md"},h=e('<h1 id="使用android-cpu-profiler性能调优" tabindex="-1">使用Android CPU Profiler性能调优 <a class="header-anchor" href="#使用android-cpu-profiler性能调优" aria-label="Permalink to &quot;使用Android CPU Profiler性能调优&quot;">​</a></h1><ol start="0"><li><p>转换导出插件勾选&quot;Profiling-funcs&quot;, 请勿使用Development(该模式将极大降低性能)。 发布上线版本请务必关闭该选项！</p></li><li><p>在Android微信小游戏打开调试进行录制</p><img src="'+t+'" width="300"></li><li><p>停止性能数据录制</p><p>与步骤1相似，在相同的菜单中选择Stop CPU Profile</p></li><li><p>传输录制文件到PC</p><p>录制结束后，Android会生成一份xxx.cpuprofile，该文件格式可以使用chrome进行解析。 因此我们需要将录制后的文件传输到PC使用chrome进行分析。 文件路径通常为：Android/data/com.tencent.mm/MicroMsg/appbrand/trace <img src="'+n+'" width="300"></p></li><li><p>利用PC(Windows/Mac)的Edge/Chrome加载数据</p><p>以Edge为例：浏览器菜单打开&quot;更多工具-开发人员工具-右上角...-更多工具-JavaScript探测器&quot;，然后点击加载前面导出的cpuprofile文件即可。 <img src="'+l+'" width="500"><img src="'+r+'" width="500"></p><p>视图有多种方式，可选择&quot;图表&quot;(Chart)分析每一帧游戏函数耗时情况</p></li><li><p>使用JavaScriptProfile进行数据分析</p><img src="'+p+`" width="700"></li></ol><p>注意：</p><ol><li>编译版本仅当导出勾选Profiling-funcs(推荐)或Development时才能在函数堆栈中看到可读函数名。</li><li>特殊情况下，如果游戏勾选Profiling-funcs会导致代码包过大，那么不要使用此选项。此时得到的Profile中函数为数字ID，有两种做法进行解读： <ul><li>2.1 通过webgl导出目录下的symbols文件对照映射</li><li>2.2 通过<a href="https://github.com/wechat-miniprogram/minigame-unity-webgl-transform/blob/main/tools/update_v8_wasm_profile.py" target="_blank" rel="noreferrer">替换脚本</a>对cpuprofile进行自动映射到真实函数。使用方式：python update_v8_wasm_profile.py $cpuprofile $symbol</li></ul></li><li>如希望能从游戏启动立即抓取profile，请在game.js末尾代码稍作修改：<div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> gl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GameGlobal.canvas.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;webgl&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    gl.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clear</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(gl.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">COLOR_BUFFER_BIT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    gameManager.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">startGame</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    GameGlobal.manager </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> gameManager;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div>修改后，游戏启动将会有10s黑屏，可在此期间打开调试。</li><li>最新版本Chrome/Edge已经将Javascript Profiler默认隐藏，你可以使用微信开发者工具查看<code>.cpuprofiler</code>，或是通过以下方式将它在浏览器显示出来： <img src="https://github.com/zombieyang/minigame-unity-webgl-transform/assets/5595819/2a4a276d-d5a7-4d1e-9cb4-891f3f984e0d" alt="image"></li></ol>`,4),d=[h];function g(k,c,m,E,f,_){return a(),s("div",null,d)}const C=i(o,[["render",g]]);export{u as __pageData,C as default};
